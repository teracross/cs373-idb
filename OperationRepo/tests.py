from urllib.request import urlopen, Request
from urllib.error import HTTPError
from json import dumps, loads
from django.test import TestCase

class SearchTest(TestCase):

    def test_search_singleword(self):
        request = Request("http://0.0.0.0:5000/operationrepo/search/?format=json&search=blah")
        response = urlopen(request)
        self.assertEqual(response.getcode(), 200)
        content = loads(response.readall().decode("utf-8"))
       
        actual = {"andresults": ["[{\"pk\": \"sZMUjLKuxXnzgfEGDDbQow\", \"model\": \"OperationRepo.review\", \"fields\": {\"date\": \"2013-02-04\", \"text\": \"Lots of TVs and good beer selection, but the food is probably below average, even for a sports bar. I had the philly which was blah and the nachos left a lot to be desired as well. Oh, and the niners lost :-(\", \"stars\": 3.0, \"user\": \"pi_f7sm9mclhBMtRHvGL1w\", \"business\": \"01cEFI5Pq_RyEwM3GSTopQ\"}}]", "[]", "[]"], "search_terms": "blah", "orresults": ["[]", "[]", "[]"]}
        self.assertTrue(content == actual)

    def test_search_tempty(self):
        request = Request('http://0.0.0.0:5000/operationrepo/search/?format=json&search=""')
        response = urlopen(request)
        self.assertEqual(response.getcode(), 200)
        content = loads(response.readall().decode("utf-8"))
        actual = {"andresults": ["[]", "[]", "[]"], "search_terms": "\"\"", "orresults": ["[]", "[]", "[]"]}
        self.assertTrue(content == actual)

    def test_search_nonexistent(self):
        request = Request('http://0.0.0.0:5000/operationrepo/search/?format=json&search=asdasdfasdf')
        response = urlopen(request)
        self.assertEqual(response.getcode(), 200)
        content = loads(response.readall().decode("utf-8"))
        actual = {"andresults": ["[]", "[]", "[]"], "search_terms": "asdasdfasdf", "orresults": ["[]", "[]", "[]"]}
        self.assertTrue(content == actual)        

    def test_search_multiple(self):
        request = Request('http://0.0.0.0:5000/operationrepo/search/?format=json&search=pool+moist')
        response = urlopen(request)
        self.assertEqual(response.getcode(), 200)
        content = loads(response.readall().decode("utf-8"))
        actual = {"andresults": ["[]", "[]", "[]"], "search_terms": "pool moist", "orresults": ["[{\"pk\": \"rPp8OWlpQX08pmaHGjsxKw\", \"model\": \"OperationRepo.review\", \"fields\": {\"date\": \"2010-11-22\", \"text\": \"Was in Scottsdale for an overnight trip and decided to stop by this place to have some dinner and watch the Suns vs Lakers game.  The joint is a really nice sports bar and grill....I've never been to a sports bar that was so nice before, I thought I had the wrong place when I arrived.  The restaurant is well kept and looks like it just opened, at least by the cleanliness and decor.\\n\\nSince I was alone, I saddled up to the bar and decided to eat and have a few Beers while I watched the game.  The menu is pretty extensive, so I asked the bartender for her recommendation.  She suggested the Boneless Wings (\\\\$7.99) or the Sliders (\\\\$7.99 + \\\\$.50 w/Cheese).....I said, \\\"What the hell, let's go for both!\\\".  I asked her to make sure the Boneless Wings were really Spicy.  Since I had been in China for the past 10 days I was in the mood for some heat.....she said that their hottest wing sauce wasn't that hot....but that the cooks could whip up  a Habanero Sauce for me.  I asked her to have the Boneless Wings prepared with Hot Sauce and put the Habanero Sauce on the side, just to be on the safe side, LOL.  To wash it down, I had a 22 oz SunUp Trooper IPA (\\\\$5.50).\\n\\nI watched the Lakers vs Suns game for a while and made some new friends at the bar while I waited for my food.  After a short wait the first dish to come out was the Boneless Wings.  The Habanero Sauce was so Hot that when they placed it down in front of me I choked on the fumes....and this was with the Sauce on the Side!  I had to move the plate off to the side, just so I could breathe....perfect!  I took one piece of Boneless Wing, dipped it into the Habanero Sauce, and took a bite....wow, it packed a big punch!  Very spicy and soooo good!  The Chicken was moist and juicy and cooked just right.....not too crunchy and not too soft....and full of flavor.\\n\\nThe Sliders came out a few minutes later....so I left 1/2 my Wing order to go try the Sliders.  There were 4 Sliders on the plate.  I tried it with a little Blue Cheese Dressing.....yum!  Then I dipped them in a little Blue Cheese then with the Habanero Sauce that came with the Wings....even better!  I told the bartender to tell the cooks that their Habanero Sauce was a huge hit and to thank them for me.\\n\\nIt took me a while, but I devoured everything I ordered.  2 IPA's later and with a Lakers' loss in the making, I asked the bartender to change up the Beer order and asked for her recommendation.  She suggested the 4 Peaks Peach Ale (22 oz \\\\$5.50)....ok, I normally don't do Peach flavored Beer but went with it anyway.  I'm glad I did, it had a nice smooth finish and you could barely taste the Peach flavor....it didn't overwhelm the brew.\\n\\nDespite a Lakers loss, I had a great time and meal here.  Kudos to the staff for making a patron happy by whipping up a spicy Habanero Sauce on the fly....you can almost feel the heat in the pics I took.\\n\\nWill I return?  You bet I will!\", \"stars\": 4.0, \"user\": \"kGgAARL2UmvCcTRfiscjug\", \"business\": \"01cEFI5Pq_RyEwM3GSTopQ\"}}, {\"pk\": \"7NgHS_RBr9jt_OqexRINag\", \"model\": \"OperationRepo.review\", \"fields\": {\"date\": \"2011-10-17\", \"text\": \"Went here on a whim for lunch and to check out the college football games. The place is like an upscale Zipps with nice sized flat screens everywhere. The hostess greeted us with a friendly smile and was very accommodating with our three table changes (first one wasn't by the game we wanted, second table was fine, but then we ran into friends and needed a bigger table). The wings are yummy, but I could have used a moist towelette at the end (bathrooms are for wussies). My date got the Texas burger that looked delicious. Apparently it was because by the time I finished my second wing, there were only a few pieces of bun left on his plate. The fries are along steak fries size, but crispy, which is fun. I got a side salad with my wings, which is a fairly decent portion with the tomatoes diced into yummy bite sizes. All in all, it gets a 4 out of 5 and I would love to go back.\", \"stars\": 4.0, \"user\": \"fl6oI21uXoxVMwfR6lFanQ\", \"business\": \"01cEFI5Pq_RyEwM3GSTopQ\"}}, {\"pk\": \"-Mvy8Ks9NPH-QV04V0H94g\", \"model\": \"OperationRepo.review\", \"fields\": {\"date\": \"2010-10-21\", \"text\": \"It was a tense and crucial situation. My usual Scottsdale sports bar lineup was not producing, and I needed a place to watch the NLCS. What to do? Well, I turned to Blue. \\\"You're my bar, Blue! You're my bar.\\\"\\n\\nI'm one intense Giants fan with certain game watching behaviors - sometimes I wear eye black or paint my face, I may jump around a lot so I need a little space, I get decked out head to toe in my team's colors, I'll curse and talk to the TV under my breath, I'll cheer with excitement, I may bite you if you block my view of the TV (just kidding, or am I?) and I like to heckle anyone who isn't rooting for the same team as me. What can I say? I'm fierce and I love the game. My father raised one heck of a sports fan. I've got a lot of pride in my team, and not every sports bar can accommodate my love for the San Francisco Giants. \\n\\nFurthermore, I knew I needed some pop in my Scottsdale sports bar batting order but I wasn't quite sure where I was going to find it. I had heard about this Blue character but I didn't know if he would cut it in my MLB - Major League Bars. Well, Blue threw on his # 32 jersey and proved to be an All-Star player by coming through in this clutch situation. Blue 32 is a quality bar with an exceptional atmosphere. What a great acquisition! Blue 32 covered all the bases.\\n\\nBase One - Blue possesses great range in the outfield by strategically placing a ton of TVs throughout the restaurant. TVs galore! Every spot is manned and defended by a TV so it's impossible to miss a play. These huge TVs provide great visibility from all angles. That way, there are less call discrepancies. I can see all the plays up close and personal, allowing me to critique a pitcher's pitch, a batter's swing or an ump's call.\\n\\nBase Two - Blue's wait staff turned multiple 6-4-3 double plays because no one dropped or boggled the customer service ball. The bartender, the hostess, the servers, et al were attentive, friendly and fun. This gold glove caliber defensive team is on top of their game. Blue 32's service may even earn a spot in my Major League Bar Hall of Fame if this excellence continues. \\n\\nBase Three - Blue 32 hit a grand slam with a delicious and high-quality yet reasonably priced menu. The food was excellent and definitely a home run with Matt and I. Matt ordered the Shrimp Po' Boy, which he raved about. And I'm not a sandwich person but this one looked so good - packed to the brim with crispy shrimp and accompanied by some real stand out onion rings. I ordered the grilled salmon dish with rice and broccoli, and I was shocked. Not by the rice and broccoli, as it was good, but my goodness it was the salmon! For about \\\\$15, this salmon is blacked and grilled perfectly, not over cooked or chewy at all and it was so moist! Bar salmon that actually tastes good? I'm in.\\n\\nHome Base - Overall, Blue 32 just has a superior sports watching atmosphere. It gives off high class sports bar vibes as its sparkling clean compared to other places. I am so excited to come back that I'll probably skip a couple of the other bars in my rotation. The d\\u00e9cor, lighting and seating are all set up for an ultimate fan like me. This place even has excellent parking, a wonderful patio and the interior is large but it isn't gaping. It's the perfect size. I even love the full-size bar area with lights underneath. On one of the walls there's an awesome sports ticker with stats and breaking news. They also have an excellent happy hour with really fantastic deals from 4-7pm, so it fits my after work schedule. Even their cocktail, beer and wine menu gets the job done.\\n\\nWell Blue 32, your versatility has earned you starter status. I'm counting on you when I've got some serious game watching to do - and you better not disappoint. Your 5 star contract is riding it. I've got high expectations, and a great feeling that you'll succeed as the big bat in my Scottsdale sports bar lineup.\", \"stars\": 4.0, \"user\": \"w4suxL1zlxsihVlugZZDAQ\", \"business\": \"01cEFI5Pq_RyEwM3GSTopQ\"}}, {\"pk\": \"u2NF5830MGdwgQQo74ti0Q\", \"model\": \"OperationRepo.review\", \"fields\": {\"date\": \"2013-07-17\", \"text\": \"I haven't bowled in years.  So when a group of friends put together an outing here, I had to come.  We bowled on a Saturday afternoon around 1 pm and the place was wide open.  They had the black lights, neon, loud music, and lasers going on...kind of weird to have cosmic bowling in the middle of the day....whatever, it was cool.\\n\\nWe paid \\\\$20 for 2 of us to play 2 games each....\\\\$5 per game.  Price comes with the shoes.  The selection of bowling balls is kind of limited.  It took us a little while to find a ball for us to use.  Bowling was fun though...very laid back and everyone had a good time.\\n\\nThe food options here are ok....Hot Dogs, Pizza, Fries....typical bowling alley food.  On the plus side...they serve Nathan's Hot Dogs...so at least they're quality.  The Pizza is plain though...below average.\\nhttp://www.yelp.com/biz_photos/brunswick-via-linda-lanes-scottsdale?select=W8kuwKmK0s-yqa3Z_yWD0w#W8kuwKmK0s-yqa3Z_yWD0w\\n\\nSome other notes - They also have a pool table in another room.  There are lockers available to store your stuff.  If you want to drink alcoholic beverages, they have a small lounge/bar...will have to check that out next time.\\n\\nOverall, it was a very good time.  Since it's in the neighborhood, we'll definitely be back.\\n\\nReturn Factor - 90%\", \"stars\": 4.0, \"user\": \"kGgAARL2UmvCcTRfiscjug\", \"business\": \"022T8YSRmb3b1BfwzO3F7Q\"}}]", "[]", "[]"]}
        self.assertEqual(actual, content)

print ("Done")