<!-- Homepage - links to our various html pages for business, users and reviews.-->
<!DOCTYPE html>
<html>
<head> 
  <meta charset='utf-8'>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title> Operation Repo - Businesses from Yelp Academic DataSet</title>
  <link href="{{STATIC_URL}}css/bootstrap.min.css" rel="stylesheet" media="screen" type="text/css" />
  <link href="{{STATIC_URL}}css/custom.css" rel="stylesheet" media="screen" type="text/css" />
</head>

<body>
<div class="container">
  <h1>Operation Repo - Search </h1>
    {% include "navbar.html" %}
    <div class="jumbotron">
        <div class="search-result">
        <!-- AND  search results -->
        <h2>Search Results for &quot;<italic>{{search_terms}}</italic>&quot; :</h2>
        <div id="and-search-content">
            <h3>Businesses</h3>
            {% for b in andresults.businesses %}
            <div class="search-cell">
                <div>
                    <h4><a href="{% url 'business' b.business_id %}">{{b.name}}</a></h4>
                    <div class="context">
                    </div>
                </div>
            </div>
            {% empty %}
            <div class="search-empty">
                No search results...
            </div>
            {% endfor %}
            <h3>Users</h3>
            {% for u in andresults.users %}
            <div class="search-cell">
                <div>
                    <h4><a href="{% url 'user' u.user_id %}">{{u.name}}</a> </h4>
                    <div class="context">
                    </div>
                </div>
            </div>
            {% empty %}
            <div class="search-empty">
                No search results...
            </div>
            {% endfor %}
            <h3>Reviews</h3>
            {% for r in andresults.reviews %}
            <div class="search-cell">
                <div>
                    <h4>Review for {{r.business.name}} by {{r.user.name}}</h4>
                    <p>
                        <p>Date Written: {{r.date}}</p>
                        <div class="context">
                            <div class="review-text">
                                {{ r.text }}
                            </div>
                        </div>
                        <a href="{% url 'review' r.review_id %}">view</a>
                    </p>
                </div>
            </div>
            {% empty %}
            <div class="search-empty">
                No search results...
            </div>
            {% endfor %}
        </div>
        <!-- OR search results -->
        <h2>Search Results for 
                {% for s in search_list %} 
                    {% if forloop.last %}
                        &quot;<italic>{{s}}</italic>&quot;
                    {% else %}
                        &quot;<italic>{{s}}</italic>&quot; Or 
                    {% endif %}
                {% endfor %} 
        :</h2>
        <div id="or-search-content">
            <h3>Businesses</h3>
            {% for b in orresults.businesses %}
                <div class="search-cell">
                    <div>
                        <h4><a href="{% url 'business' b.business_id %}">{{b.name}}</a></h4>
                        <div class="context">
                        </div>
                    </div>
                </div>
            {% empty %}
            <div class="search-empty">
                No search results...
            </div>
            {% endfor %}
            <h3>Users</h3>
            {% for u in orresults.users %}
                <div class="search-cell">
                    <div>
                        <h4><a href="{% url 'user' u.user_id %}">{{u.name}}</a> </h4>
                        <div class="context">
                        </div>
                    </div>
                </div>
            {% empty %}
            <div class="search-empty">
                No search results...
            </div>
            {% endfor %}
            <h3>Reviews</h3>
            {% for r in orresults.reviews %}
                <div class="search-cell">
                    <div>
                        <h4>Review for {{r.business.name}} by {{r.user.name}}</h4>
                        <p>
                            <div class="context">
                                <div class="review-text">
                                    {{ r.text }}
                                </div>
                            </div>
                            <a href="{% url 'review' r.review_id %}">view</a>
                        </p>
                    </div>
                </div>
            {% empty %}
            <div class="search-empty">
                    No search results...
            </div>
            {% endfor %}
        </div>
        </div>
    </div>
</div>
    <!-- Bootstrap -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <script src="{{STATIC_URL}}js/bootstrap.min.js"></script>
    <script type="text/javascript">
        $(document).ready(function(){
            $('#and-search-content .context').each(function(){
                var searcht = "{{search_terms}}";
                var searchtext = $(this).html();
                var index = searchtext.search(searcht);
                var newinner = "";
                if(index > -1){
                    var w = searchtext.substring(Math.max(index-20, 0), index+20);
                    w = w.replace(searcht, "<bold>".concat(searcht,"</bold>"));
                    newinner = " ...".concat(w,"... ");
                }
                searchtext = searchtext.substring(index+1);
                index = searchtext.search(searcht);
                if(index > -1){
                    var w = searchtext.substring(Math.max(index-20, 0), index+20);
                    w = w.replace(searcht, "<bold>".concat(searcht,"</bold>"));
                    newinner = newinner.concat(" ...",w, "... ");
                }
                $(this).html(newinner);
            });

            $('#or-search-content .context').each(function(){
                var searcht = [{% for s in search_list%}{% if forloop.last %} "{{s}}" {% else %} "{{s}}", {% endif %}{% endfor %}];
                var searchtext = $(this).html();
                var newinner = "";
                for (var i = searcht.length - 1; i >= 0; i--) {
                    var index = searchtext.search(searcht[i]);
                    if(index > -1){
                        var w = searchtext.substring(Math.max(index-20, 0), index+20);
                        w = w.replace(searcht[i], "<bold>".concat(searcht[i],"</bold>"));
                        newinner = newinner.concat(" ...",w,"... ");
                    }
                    searchtext = searchtext.substring(index+1);
                    index = searchtext.search(searcht[i]);
                    if(index > -1){
                        var w = searchtext.substring(Math.max(index-20, 0), index+20);
                        w = w.replace(searcht[i], "<bold>".concat(searcht[i],"</bold>"));
                        newinner = newinner.concat(" ...",w, "... ");
                    }
                    searchtext = $(this).html();
                };
                $(this).html(newinner);
            });
        });
    </script>
</body>
</html>